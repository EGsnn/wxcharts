//index.js
//获取应用实例
var app = getApp()
var chart = require('EGchart.js');
var data1 = require('../data/data.js');
Page({
  data: {
    indicatorDots: true,
    vertical: false,
    autoplay: true,
    interval: 3000,
    duration: 1200,
    timer:[],
    data1:[],
    data2:[],
    stockIndex:{
      min_time:[],
      last_px:[],
      avg_px:[],
      BA_color:[],
      business_amount:[]
    },
    stockIndex1: {
      min_time: [],
      last_px: [],
      avg_px: [],
      BA_color: [],
      business_amount: []
    },
  },
  proData:function(data,setData){
    var _flag = 0, _flag1 = 0,_color = 'red';
    data.forEach(function (item, index) {
      // if(index>50){return}
     setData.min_time.push(item[0]);
     setData.last_px.push(item[1]);
     setData.avg_px.push(item[2]);
     setData.business_amount.push(item[3] - _flag);
     item[1] - _flag1 >= 0 ? _color = 'red' : _color='green';
     setData.BA_color.push(_color);
      _flag = item[3];
      _flag1 = item[1];
    });
  },
  onLoad: function() {
    var me = this;
    var data = { "data": { "trend": { "fields": ["min_time", "last_px", "avg_px", "business_amount"], "crc": { "601766.SS": 20170816 }, "preclose_px": { "601766.SS": 9.90 }, "601766.SS": [[201708160930, 9.89, 9.89, 61300], [201708160931, 9.88, 9.88, 258800], [201708160932, 9.87, 9.87, 430300], [201708160933, 9.87, 9.87, 471300], [201708160934, 9.86, 9.87, 584800], [201708160935, 9.87, 9.87, 666620], [201708160936, 9.87, 9.87, 889020], [201708160937, 9.87, 9.87, 963020], [201708160938, 9.88, 9.87, 1105820], [201708160939, 9.87, 9.87, 1175020], [201708160940, 9.87, 9.87, 1356320], [201708160941, 9.86, 9.87, 1426420], [201708160942, 9.87, 9.87, 1618020], [201708160943, 9.86, 9.87, 1677220], [201708160944, 9.86, 9.87, 1937020], [201708160945, 9.87, 9.87, 2012920], [201708160946, 9.87, 9.87, 2082720], [201708160947, 9.87, 9.87, 2296820], [201708160948, 9.87, 9.87, 2390620], [201708160949, 9.87, 9.87, 2448920], [201708160950, 9.87, 9.87, 2811820], [201708160951, 9.86, 9.87, 2868920], [201708160952, 9.86, 9.87, 2963920], [201708160953, 9.87, 9.87, 3157620], [201708160954, 9.86, 9.87, 3321320], [201708160955, 9.86, 9.87, 3438520], [201708160956, 9.86, 9.87, 3640620], [201708160957, 9.87, 9.87, 3947020], [201708160958, 9.87, 9.87, 4054420], [201708160959, 9.86, 9.87, 4193320], [201708161000, 9.86, 9.87, 4350620], [201708161001, 9.87, 9.87, 4392420], [201708161002, 9.86, 9.87, 4486120], [201708161003, 9.86, 9.86, 4792469], [201708161004, 9.85, 9.86, 4924669], [201708161005, 9.86, 9.86, 4989569], [201708161006, 9.86, 9.86, 5010369], [201708161007, 9.86, 9.86, 5103469], [201708161008, 9.85, 9.86, 5179769], [201708161009, 9.86, 9.86, 5322769], [201708161010, 9.86, 9.86, 5407869], [201708161011, 9.85, 9.86, 5457469], [201708161012, 9.86, 9.86, 5725969], [201708161013, 9.85, 9.86, 6146869], [201708161014, 9.85, 9.86, 6331069], [201708161015, 9.85, 9.86, 6525069], [201708161016, 9.86, 9.86, 6576969], [201708161017, 9.86, 9.86, 6645469], [201708161018, 9.86, 9.86, 6687369], [201708161019, 9.85, 9.86, 6797269], [201708161020, 9.85, 9.86, 6954269], [201708161021, 9.85, 9.86, 6981469], [201708161022, 9.85, 9.86, 7114769], [201708161023, 9.86, 9.86, 7193669], [201708161024, 9.85, 9.86, 7293379], [201708161025, 9.86, 9.86, 7472179], [201708161026, 9.85, 9.86, 7554879], [201708161027, 9.86, 9.86, 7601879], [201708161028, 9.85, 9.86, 7671879], [201708161029, 9.86, 9.86, 7707379], [201708161030, 9.85, 9.86, 7764479], [201708161031, 9.86, 9.86, 7804079], [201708161032, 9.86, 9.86, 7848979], [201708161033, 9.85, 9.86, 8015179], [201708161034, 9.85, 9.86, 8124179], [201708161035, 9.86, 9.86, 8202679], [201708161036, 9.85, 9.86, 8591679], [201708161037, 9.86, 9.86, 8682779], [201708161038, 9.85, 9.86, 8760179], [201708161039, 9.86, 9.86, 8807117], [201708161040, 9.86, 9.86, 8933317], [201708161041, 9.85, 9.86, 8986717], [201708161042, 9.86, 9.86, 9101957], [201708161043, 9.85, 9.86, 9141957], [201708161044, 9.85, 9.86, 9333357], [201708161045, 9.86, 9.86, 9423767], [201708161046, 9.86, 9.86, 9623367], [201708161047, 9.86, 9.86, 9646567], [201708161048, 9.85, 9.86, 9889667], [201708161049, 9.85, 9.86, 9998067], [201708161050, 9.85, 9.86, 10091367], [201708161051, 9.85, 9.86, 10149067], [201708161052, 9.86, 9.86, 10225702], [201708161053, 9.86, 9.86, 10268602], [201708161054, 9.86, 9.86, 10295602], [201708161055, 9.85, 9.86, 10357302], [201708161056, 9.85, 9.86, 10614502], [201708161057, 9.85, 9.86, 10664402], [201708161058, 9.86, 9.86, 10770602], [201708161059, 9.85, 9.86, 10870602], [201708161100, 9.85, 9.86, 10984402], [201708161101, 9.84, 9.86, 11037212], [201708161102, 9.84, 9.86, 11094012], [201708161103, 9.85, 9.86, 11140462], [201708161104, 9.85, 9.86, 11171162], [201708161105, 9.85, 9.86, 11208762], [201708161106, 9.85, 9.86, 11268662], [201708161107, 9.85, 9.86, 11388362], [201708161108, 9.85, 9.86, 11438162], [201708161109, 9.85, 9.86, 11489513], [201708161110, 9.85, 9.86, 11658613], [201708161111, 9.85, 9.86, 11699713], [201708161112, 9.85, 9.86, 11913033], [201708161113, 9.85, 9.86, 12037833], [201708161114, 9.85, 9.86, 12148033], [201708161115, 9.85, 9.86, 12204833], [201708161116, 9.85, 9.86, 12302233], [201708161117, 9.86, 9.86, 12354133], [201708161118, 9.85, 9.86, 12593233], [201708161119, 9.86, 9.86, 12628733], [201708161120, 9.86, 9.86, 12775633], [201708161121, 9.86, 9.86, 12799533], [201708161122, 9.86, 9.86, 12830733], [201708161123, 9.86, 9.86, 12854033], [201708161124, 9.85, 9.86, 12872233], [201708161125, 9.86, 9.86, 12951944], [201708161126, 9.86, 9.86, 12973344], [201708161127, 9.86, 9.86, 13056344], [201708161128, 9.85, 9.86, 13087744], [201708161129, 9.86, 9.86, 13133444], [201708161130, 9.86, 9.86, 13268444], [201708161301, 9.88, 9.86, 13777564], [201708161302, 9.88, 9.86, 13838064], [201708161303, 9.88, 9.86, 13854064], [201708161304, 9.88, 9.86, 13900864], [201708161305, 9.88, 9.86, 13930564], [201708161306, 9.87, 9.86, 14074004], [201708161307, 9.87, 9.86, 14126554], [201708161308, 9.88, 9.86, 14181904], [201708161309, 9.87, 9.86, 14199204], [201708161310, 9.89, 9.86, 14369864], [201708161311, 9.88, 9.86, 14406164], [201708161312, 9.89, 9.86, 14448464], [201708161313, 9.89, 9.86, 14486964], [201708161314, 9.89, 9.86, 14529464], [201708161315, 9.89, 9.86, 14597214], [201708161316, 9.88, 9.86, 14623314], [201708161317, 9.88, 9.86, 14691414], [201708161318, 9.89, 9.86, 14712714], [201708161319, 9.88, 9.86, 14745614], [201708161320, 9.88, 9.86, 14762914], [201708161321, 9.88, 9.86, 14819914], [201708161322, 9.88, 9.86, 14860614], [201708161323, 9.87, 9.86, 14911914], [201708161324, 9.87, 9.86, 14959724], [201708161325, 9.87, 9.86, 14975324], [201708161326, 9.87, 9.86, 14986124], [201708161327, 9.88, 9.86, 15012324], [201708161328, 9.87, 9.86, 15027224], [201708161329, 9.87, 9.86, 15047724], [201708161330, 9.87, 9.86, 15134864], [201708161331, 9.88, 9.86, 15188624], [201708161332, 9.88, 9.86, 15198124], [201708161333, 9.87, 9.86, 15240224], [201708161334, 9.87, 9.86, 15334364], [201708161335, 9.86, 9.86, 15397624], [201708161336, 9.87, 9.86, 15416214], [201708161337, 9.88, 9.86, 15448614], [201708161338, 9.87, 9.86, 15491514], [201708161339, 9.87, 9.86, 15501614], [201708161340, 9.88, 9.86, 15548214], [201708161341, 9.87, 9.86, 15573314], [201708161342, 9.88, 9.86, 15613214], [201708161343, 9.88, 9.86, 15624714], [201708161344, 9.87, 9.86, 15685724], [201708161345, 9.87, 9.86, 15931434], [201708161346, 9.87, 9.86, 15967334], [201708161347, 9.88, 9.86, 15994634], [201708161348, 9.88, 9.86, 16062534], [201708161349, 9.88, 9.86, 16191834], [201708161350, 9.87, 9.86, 16203834], [201708161351, 9.88, 9.86, 16222834], [201708161352, 9.88, 9.86, 16547234], [201708161353, 9.87, 9.86, 16682534], [201708161354, 9.87, 9.86, 16744834], [201708161355, 9.87, 9.86, 16875724], [201708161356, 9.87, 9.86, 17416324], [201708161357, 9.86, 9.86, 17539364], [201708161358, 9.87, 9.86, 17857324], [201708161359, 9.87, 9.86, 17952924], [201708161400, 9.86, 9.86, 18307864], [201708161401, 9.86, 9.86, 18915864], [201708161402, 9.85, 9.86, 19891953], [201708161403, 9.86, 9.86, 20085064], [201708161404, 9.86, 9.86, 20513864], [201708161405, 9.86, 9.86, 20663664], [201708161406, 9.86, 9.86, 20836034], [201708161407, 9.85, 9.86, 21323234], [201708161408, 9.85, 9.86, 21584684], [201708161409, 9.85, 9.86, 21730184], [201708161410, 9.86, 9.86, 21911784], [201708161411, 9.86, 9.86, 22002184], [201708161412, 9.85, 9.86, 22059084], [201708161413, 9.87, 9.86, 22112374], [201708161414, 9.86, 9.86, 22158384], [201708161415, 9.86, 9.86, 22305374], [201708161416, 9.86, 9.86, 22436584], [201708161417, 9.85, 9.86, 22488184], [201708161418, 9.86, 9.86, 22503384], [201708161419, 9.85, 9.86, 22584984], [201708161420, 9.85, 9.86, 22801084], [201708161421, 9.86, 9.86, 22829984], [201708161422, 9.85, 9.86, 22898011], [201708161423, 9.86, 9.86, 22945811], [201708161424, 9.86, 9.86, 22990911], [201708161425, 9.85, 9.86, 23091011], [201708161426, 9.85, 9.86, 23218111], [201708161427, 9.85, 9.86, 23447501], [201708161428, 9.86, 9.86, 23535901], [201708161429, 9.87, 9.86, 23627701], [201708161430, 9.86, 9.86, 23643701], [201708161431, 9.86, 9.86, 23703115], [201708161432, 9.86, 9.86, 23737915], [201708161433, 9.87, 9.86, 23768115], [201708161434, 9.86, 9.86, 23831217], [201708161435, 9.86, 9.86, 23882301], [201708161436, 9.86, 9.86, 23930117], [201708161437, 9.87, 9.86, 23993117], [201708161438, 9.86, 9.86, 24157717], [201708161439, 9.86, 9.86, 24244267], [201708161440, 9.86, 9.86, 24535817], [201708161441, 9.86, 9.86, 24576417], [201708161442, 9.86, 9.86, 24637257], [201708161443, 9.86, 9.86, 24784357], [201708161444, 9.86, 9.86, 24837677], [201708161445, 9.87, 9.86, 24899477], [201708161446, 9.87, 9.86, 24988477], [201708161447, 9.87, 9.86, 25342897], [201708161448, 9.88, 9.86, 25405197], [201708161449, 9.87, 9.86, 25557897], [201708161450, 9.87, 9.86, 25626277], [201708161451, 9.87, 9.86, 26092677], [201708161452, 9.89, 9.86, 26224917], [201708161453, 9.89, 9.86, 26300517], [201708161454, 9.88, 9.86, 26804917], [201708161455, 9.88, 9.86, 28396037], [201708161456, 9.87, 9.86, 28569517], [201708161457, 9.87, 9.86, 28741317], [201708161458, 9.88, 9.86, 28800017], [201708161459, 9.88, 9.86, 28956637], [201708161500, 9.87, 9.86, 29217537]] } } }
;
    
    
  
   
    this.proData(data1.data.trend['000001.SS'], me.data.stockIndex);
    this.proData(data.data.trend['601766.SS'], me.data.stockIndex1);
    var Pwidth = 0;
    wx.getSystemInfo({
      success: function (res) {
         Pwidth = res.windowWidth;
      }
    });

    // 折线图1
    new chart.line({
      canvasId: 'stockIndex',
      type: 'trend',
      windowWidth: Pwidth,
      width: 700,
      height: 550,
      lineWidth: 2,
      lineColor: '#aaaaaa',
      textColor: '#ccc',
      categories: me.data.stockIndex.min_time,
      business_amount: me.data.stockIndex.business_amount,
      BA_color: me.data.stockIndex.BA_color,
      preclose_px: 3250.60,
      series: [{
        name: '最新价',
        width: 1.5,
        color: "#f3aca7",
        data: me.data.stockIndex.last_px
      }, {
        name: '均价',
        width: 1.5,
        color: "#e1cc78",
        data: me.data.stockIndex.avg_px
      }],
    });
    // 折线图2
    new chart.line({
      canvasId: 'lineCanvas',
      type:'trend',
      windowWidth: Pwidth,
      width: 700,
      height:550,
      lineWidth:2,
      lineColor:'#aaaaaa',
      textColor:'#ccc',
      categories: me.data.stockIndex1.min_time,
      business_amount: me.data.stockIndex1.business_amount,
      BA_color: me.data.stockIndex1.BA_color,
      preclose_px:9.90,
      series: [{
        name: '组合',
        width:1.5,
        color: "#f3aca7",
        data: me.data.stockIndex1.last_px
      }, {
          name: '折线图',
          width: 1.5,
          color: "#e1cc78",
          data: me.data.stockIndex1.avg_px
      }]
    });
    // 普通折线图
    new chart.line({
      canvasId: 'stockChart',
      type: 'index',
      windowWidth: Pwidth,
      width: 700,
      height: 500,
      lineWidth: 2,
      lineColor: '#aaaaaa',
      textColor: '#ccc',
      categories: [1, 2, 3, 4, 5],
      series: [{
        name: '组合',
        width: 2,
        color: "#ba2768",
        data: [21, 25, 0, -10, 18]
      }, {

          name: '折线图',
        width: 2,
        color: "#7aa0db",
        data: [-15, -15, 18, 13, -17]
      }],
    })
  },
  onShareAppMessage: function (res) {
    if (res.from === 'button') {
      // 来自页面内转发按钮
      console.log(res.target)
    }
    return {
      title: 'egchart',
      path: "pages/home/index",
      success: function (res) {

        // 转发成功
      },
      fail: function (res) {
        // 转发失败
      }
    }
  }
})
